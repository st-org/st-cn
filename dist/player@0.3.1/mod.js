var e={d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{Ec:()=>n,F_:()=>a,SM:()=>s,AS:()=>r,hM:()=>o});class n{constructor(){this.element=document.createElement("div"),this.rate=.5,this.element.classList.add("rate-bar"),this.element.addEventListener("click",(e=>{this.setValue(e.offsetX/this.element.offsetWidth)})),this.render()}render(){this.element.style.setProperty("--rate",this.rate.toString())}getValue(){return this.rate}setValue(e){isFinite(e)&&(e<0?e=0:e>1&&(e=1),this.rate=e,this.render())}}function a(e,t){return Math.exp(2*(e-.5)*Math.log(t))}function s(e,t){return Math.log(e)/Math.log(t)/2+.5}function r(e){isFinite(e)||(e=0);const t=Math.floor(e%3600/60).toString().padStart(2,"0")+":"+Math.floor(e%60).toString().padStart(2,"0");return e<=3600?t:Math.floor(e/3600).toString()+":"+t}const i=["autoplay","controls","crossorigin","loop","muted","poster","preload"],o=async(e,t)=>{const o=document.createElement("div"),d=document.createElement("video"),l=document.createElement("div"),c=document.createElement("div"),p=document.createElement("div"),u=document.createElement("button"),m=new n,v=document.createElement("div"),h=new n,y=document.createElement("div"),L=new n,g=document.createElement("div");function f(e){const{seekable:t}=d;for(let n=0;n<t.length;n++)if(t.start(n)<=e&&e<=t.end(n))return d.currentTime=e,void(v.textContent=`${r(d.currentTime)}/${r(d.duration)}`)}o.append(d),o.append(l),l.append(c),l.append(p),c.append(u),c.append(m.element),c.append(v),p.append(new Text("Speed")),p.append(h.element),p.append(y),p.append(new Text("Brightness")),p.append(L.element),p.append(g),l.classList.add("hide"),u.classList.add("show-icon"),u.classList.add("play"),m.setValue(0),v.textContent=`${r(0)}/${r(0)}`,y.textContent="1.0",g.textContent="1.0";const{src:E,time:k}=e.options;"string"==typeof E&&(d.src=t.context.urlToAbsURL(E,e)),"number"==typeof k&&isFinite(k)&&k>0&&f(k);for(const n of i){let a=e.options[n]??t.context.extractLastGlobalOption(n,"player");if(!0===a&&(a=""),"string"==typeof a)try{d.setAttribute(n,a)}catch(e){console.log(e)}}function x(){const e=a(L.getValue(),10);d.style.setProperty("--brightness",e.toString()),g.textContent=e.toFixed(1)}d.addEventListener("click",(()=>{l.classList.toggle("hide")})),u.addEventListener("click",(async()=>{u.classList.contains("pushing")||(u.classList.add("pushing"),u.classList.contains("play")?await d.play():d.pause(),u.classList.remove("pushing"))})),m.element.addEventListener("click",(()=>{f(m.getValue()*d.duration)})),h.element.addEventListener("click",(()=>{d.playbackRate=Math.exp(2*(h.getValue()-.5)*Math.log(5))})),L.element.addEventListener("click",x),d.addEventListener("loadedmetadata",(()=>{v.textContent=`${r(d.currentTime)}/${r(d.duration)}`,o.classList.remove("loading")})),d.addEventListener("playing",(()=>{o.classList.remove("loading")})),d.addEventListener("waiting",(()=>{o.classList.add("loading")})),d.addEventListener("error",(()=>{o.classList.add("error")})),d.addEventListener("play",(()=>{u.classList.remove("play"),u.classList.add("pause")})),d.addEventListener("pause",(()=>{u.classList.add("play"),u.classList.remove("pause")})),d.addEventListener("ended",(()=>{u.classList.add("play"),u.classList.remove("pause")}));let b=0;return d.addEventListener("timeupdate",(()=>{const e=Date.now();e-b<500&&d.currentTime!==d.duration||(b=e,m.setValue(d.currentTime/d.duration),v.textContent=`${r(d.currentTime)}/${r(d.duration)}`)})),d.addEventListener("ratechange",(()=>{const e=d.playbackRate;h.setValue(s(e,5)),y.textContent=e.toFixed(1)})),u.addEventListener("keydown",(e=>"ArrowLeft"===e.key?(e.preventDefault(),void f(d.currentTime-10)):"ArrowRight"===e.key?(e.preventDefault(),void f(d.currentTime+10)):"ArrowUp"===e.key?(e.preventDefault(),L.setValue(s(a(L.getValue(),10)+.1,10)),void x()):"ArrowDown"===e.key?(e.preventDefault(),L.setValue(s(a(L.getValue(),10)-.1,10)),void x()):"["===e.key?(e.preventDefault(),void(d.playbackRate=Math.max(.2,d.playbackRate-.1))):"]"===e.key?(e.preventDefault(),void(d.playbackRate=Math.min(5,d.playbackRate+.1))):void 0)),d.append(await t.compileInlineSTDN(e.children)),o};var d=t.Ec,l=t.hM,c=t.AS,p=t.F_,u=t.SM;export{d as RateBar,l as player,c as prettyTime,p as rateToScale,u as scaleToRate};